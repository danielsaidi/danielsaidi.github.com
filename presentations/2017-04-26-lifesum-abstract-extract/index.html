<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Abstract, Extract</title>

		<meta name="description" content="New Audio Player Demo">
		<meta name="author" content="Daniel Saidi, daniel.saidi@gmail.com">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="../css/reveal.css">
		<link rel="stylesheet" href="../css/theme/bookbeat.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="../lib/css/zenburn.css">

		<link href='https://fonts.googleapis.com/css?family=Playfair+Display:400,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../css/print/pdf.css' : '../css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<style>
			.title-page h1 { font-size: 3em !important; }
			.title-page p { font-weight: bold; }
			h2 { font-size: 2em !important; }
			pre { background-color: white; }
		</style>

		<!--[if lt IE 9]>
		<script src="../lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-markdown class="title-page">
					# Abstract, Extract
					### How abstractions and libraries can help you untie that big ball of twine

					@danielsaidi
				</section>


				<section>
					<section data-markdown>
						# Daniel Saidi
						### iOS Lead @ BookBeat
					</section>

					<section data-markdown>
						## Previously
						* .NET
						* Web
						* Android
						* Java, C / C++
						* Windows Mobile anno 2005 :)
					</section>

					<section data-markdown>
						## Previous roles
						* .NET Developer
						* System Architect
						* Lead Developer
						* Team Coach
					</section>

					<section data-markdown>
						## Code quality
						* Very important to me
						* ...and yet, I often suck at it
						* Constant work in progress
						* Strange how hard the easy is
					</section>

					<section data-markdown>
						## Today's talk
						* BookBeat case study
						* How did they get where they are
						* iOS-specific challenges
						* My approach to solve them
					</section>
				</section>


				<section>
					<section data-markdown>
						# BookBeat
						### A startup story
					</section>

					<section data-markdown>
						## Audio Books & e-books
						* Stream & Download
						* Monthly fee, unlimited use
						* Soft launch late 2015
						* Real launch spring 2016
					</section>

					<section data-markdown>
						## Competitors
						* Audible
						* Storytel
						* Nextory
						* ...and many others
					</section>

					<section data-markdown>
						## Starting off...
						* What should we do?
						* How should we do it?
						* How much do we charge for "it"?
						* Partnerships, publishers, reporting?
					</section>

					<section data-markdown>
						## Marketing
						* What should we call it?
						* Graphics, fonts, colors
						* Tonality
						* Marketing channels
					</section>

					<section data-markdown>
						## Tech
						* Backend
						* Integrations
						* Api(s)
						* Applications
					</section>

					<section data-markdown>
						## Process
						* Discovery & learning driven
						* Constant changes
						* Fine-tune, change, pivot
						* Adaptability is key
					</section>

					<section data-markdown>
						## Code
						* Adaptability over architecture
						* Build it right once we know
						* Avoid premature optimization
						* (Apps) Test most important parts only
					</section>

					<section data-markdown>
						## 1 Year Later 
						* Constant changes!
						* Rushed development, tech debt
						* BUT - Many great things in place
						* AND - They got a business launched
					</section>

					<section data-markdown>
						## But...
						* We'll focus on the tech debt :)
					</section>
				</section>


				<section>
					<section data-markdown>
						# Keeping it together
						### How do you keep your code base sane?
					</section>

					<section data-markdown>
						## Good practices
						* Minimize coupling
						* Minimize inheritance
						* Keep it simple!
						* Don't let dependencies leak
					</section>

					<section data-markdown>
						## Spike & Stabilize
						* Dan North, 2011
						* Good for changing scope, pivots etc.
						* Optimize for throwawayability
						* Code should be easy to throw away
					</section>

					<section data-markdown>
						## Throwawayability
						* Start with a prototype
						* Stabilize if proven valuable
						* Throw away if proven worthless 
						* Does NOT mean write "ad hoc code"
					</section>
				</section>

				<section>
					<section data-markdown>
						# But what if you fail?
						### How can your code go insane?
					</section>

					<section data-markdown class="image-section" data-background="code-smell.gif">
						# Code-smell!
					</section>

					<section data-markdown>
						## Code smell
						* A surface indication of deeper problems
						* Violate fundamental design principles
						* Usually not bugs
						* Bad habits, inexperience, stress
					</section>

					<section data-markdown class="image-section" data-background="code-smell-hands.gif">
						# Any code-smells?
					</section>

					<section data-markdown>
						## Code smells
						* Duplicated code
						* Over-complicated code
						* Large classes
						* Spaghetti code
					</section>

					<section data-markdown>
						## Code smells
						* Hard coupling
						* Cyclomatic complexity
						* No abstractions (how, not what)
						* Existing tests are disabled
					</section>
				</section>


				<section>
					<section data-markdown>
						# So, BookBeat?
						### How did the code-base look?
					</section>

					<section data-markdown class="image-section" data-background="secret.gif">
						# Secret
					</section>

					<section data-markdown>
						## Code problems
						* CoreData everywhere
						* RestKit everywhere
						* Premature frameworks
						* Rigid code
					</section>

					<section data-markdown>
						## Project problems
						* Slow build times
						* All logic in the app
						* Existing unit tests disabled
						* Can't add tests (segmentation fault 11)
					</section>

					<section data-markdown class="image-section" data-background="https://s-media-cache-ak0.pinimg.com/originals/03/ad/71/03ad71abf3741f3188428ff0d95d1616.gif">
					</section>

					<section data-markdown class="image-section" data-background="https://s-media-cache-ak0.pinimg.com/originals/db/91/c1/db91c177933567e8e1a10ba9da96cd02.jpg">
					</section>

					<section data-markdown>
						## How are we handling it?
						* Baby steps!
						* Simplify, clarify
						* Break up dependencies
						* Extract code into libraries
					</section>

					<section data-markdown>
						## CocoaPods
						* Package Manager for iOS
						* Alternatives: Carthage, Swift PM
						* ✖ CocoaPod repo
						* ✔ Private git repos + Development pods
					</section>

					<section data-markdown>
						## Pros
						* Pods can be used in multiple apps
						* Minimizes the app's responsibility
						* Faster build → easier unit testing
						* Reduces coupling, forces abstraction
					</section>

					<section data-markdown>
						## Cons
						* Slower build times (not always)
						* Number of pods can pile up
						* Library versioning hell
						* Sometimes too much complexity
					</section>

					<section data-markdown>
						## Current state
						* BookBeat app - 40% less code
						* BBCore (core logic + utils)
						* BBAudioPlayer (audio player)
						* BBDomain (domain model + api)
						* CI & Unit Tests for each project 
					</section>

					<section data-markdown>
						## Remaining challenges
						* Make domain model abstract
						* Replace RestKit with Alamofire
						* Replace CoreData with Realm
						* Re-enable tests for main app
					</section>
				</section>

				<section>

					<section data-markdown>
						# Demo
					</section>

					<section data-markdown>
						## Initial setup
						* One app with all logic
						* API: RestaurantLite
						* Realm: Restaurant
						* API & Realm services
						* Hard Coupling
					</section>

					<section data-markdown>
						## Create library pod
						* Abstract domain model
						* RestaurantOverview
						* Restaurant: RestaurantOverview
						* Abstract service
					</section>

					<section data-markdown>
						## Adjust app
						* Rename API entities
						* Rename Realm entity
						* Add development pod
						* Remove coupling by using abstractions
					</section>

					<section data-markdown>
						## App (cont.)
						* Make UI use abstract entities
						* Make services implement abstract
						* Inject abstract service into Realm
						* API can now be moved anywhere!
					</section>

					<section data-markdown>
						## App (cont.)
						* Discuss IoC
						* Add Dip
						* Bootstrap application
						* Run
					</section>
				</section>

				<section>
					<section data-markdown>
						# Wrapping up
					</section>

					<section data-markdown>
						## BookBeat-specific
						* No silver bullet
						* Works great for us
						* Pods is not the only way
						* Approach depends on the app
					</section>

					<section data-markdown>
						## Some advice
						* Abstract - What, not how
						* Get good practices in place early on
						* Reduce coupling (DI)
						* Write tests, at least one test
					</section>
				</section>

				<section data-markdown>
					# Thank you!
					* @danielsaidi
				</section>

			</div>
		</div>

		<script src="../lib/js/head.min.js"></script>
		<script src="../js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: '../lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: '../plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '../plugin/zoom-js/zoom.js', async: true },
					{ src: '../plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
